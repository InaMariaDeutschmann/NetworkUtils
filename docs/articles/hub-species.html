<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Identifying hub species • NetworkUtils</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">NetworkUtils</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/environmental-factors.html">Evaluating the effect of environmental factors on network inference</a>
    </li>
    <li>
      <a href="../articles/hub-species.html">Identifying hub species</a>
    </li>
    <li>
      <a href="../articles/testing_network_tools.html">Testing Network Inference Tools</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/ramellose/NetworkUtils">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>Identifying hub species</h1>
                        <h4 class="author">Lisa Rottjers</h4>
            
            <h4 class="date">2018-05-02</h4>
          </div>

    
    
<div class="contents">
<p>In this simulation, we used the generalized Lotka-Volterra equation to generate these datasets. Because Klemm-Eguíluz matrices share properties with known biological networks, these matrices can be used to study whether network inference tools are able to correctly identify hubs from a dataset.</p>
<div id="dataset-generation" class="section level2">
<h2 class="hasAnchor">
<a href="#dataset-generation" class="anchor"></a>Dataset generation</h2>
<p>Because these sections of code take a long time to run, we are visualizing data that is included in the “data” folder in this repository. However, the code below shows how it was generated.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">setname =<span class="st"> "_hub"</span>
wdir=<span class="st">"insertfilepath"</span> <span class="co"># Needs to be supplied for the other sections of code to restore your filepath</span>
<span class="kw">setwd</span>(wdir)
 
allhubklemm =<span class="st"> </span>NetworkUtils<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/NetworkUtils/topics/generateKlemms">generateKlemms</a></span>(<span class="dv">100</span>, <span class="dv">100</span>, <span class="dv">10</span>, <span class="fl">0.05</span>) <span class="co"># the generateKlemms function has two outputs:</span>
hubklemms =<span class="st"> </span>allklemm[[<span class="dv">1</span>]] <span class="co"># a matrix with interaction strengths, used to generate datasets</span>
hubklemmadj=allklemm[[<span class="dv">2</span>]] <span class="co"># an adjacency matrix, used to evaluate inferred networks</span>

<span class="co"># This function generates the datasets</span>
hubdata =<span class="st"> </span><span class="kw"><a href="../reference/generateSets.html">generateSets</a></span>(<span class="dt">n=</span><span class="dv">100</span>, <span class="dt">klemms=</span>hubklemms, <span class="dt">species=</span><span class="dv">100</span>, <span class="dt">samples=</span><span class="dv">80</span>, <span class="dt">x=</span><span class="dv">1</span>, <span class="dt">mode=</span><span class="st">"env"</span>, <span class="dt">name=</span>setname)

<span class="co"># We ran CoNet and SparCC from a VM; make sure you set the working directory correctly before using writeSets or writeFeatures</span>
<span class="kw"><a href="../reference/writeSets.html">writeSets</a></span>(<span class="dt">n=</span><span class="dv">100</span>, <span class="dt">x=</span><span class="dv">1</span>, hubdata)</code></pre></div>
</div>
<div id="network-inference" class="section level2">
<h2 class="hasAnchor">
<a href="#network-inference" class="anchor"></a>Network inference</h2>
<p>Just like before, we are not running this code; especially gCoda can take a long time to run when environmental strength becomes greater. The results are in the “data/Hub species networks” folder. The callTools function wraps several network inference tools that can be called from R and stores the output to the current working directory. For CoNet and SparCC, we used virtual machines. The bash scripts to run these tools are also included in the “data” folder, and just need to be modified to run from 1 to 100.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># This function runs network inference and analyses the inferred networks</span>
<span class="kw"><a href="../reference/callTools.html">callTools</a></span>(hubdata, hubklemmadj, <span class="dt">toolnames=</span><span class="kw">c</span>(<span class="st">"SpiecEasi GL"</span>, <span class="st">"SpiecEasi MB"</span>, <span class="st">"gCoda"</span>, <span class="st">"Spearman"</span>), setname, <span class="dt">x=</span><span class="dv">1</span>, <span class="dt">n=</span><span class="dv">100</span>, <span class="dt">absolute =</span> <span class="ot">TRUE</span>,  <span class="dt">mode=</span><span class="st">"env"</span>)

<span class="co"># After running bashscript_CoNet.bash, this function can be used to parse the CoNet output </span>
<span class="kw"><a href="../reference/readCoNet.html">readCoNet</a></span>(<span class="dt">name=</span><span class="st">"brown"</span>, <span class="dt">mode=</span><span class="st">"hubs"</span>, <span class="dt">x=</span><span class="dv">1</span>, <span class="dt">n=</span><span class="dv">100</span>, <span class="dt">alldata=</span>hubdata, <span class="dt">setname=</span>set4, <span class="dt">tool=</span><span class="st">"CoNet Brown"</span>, <span class="dt">klemmadj=</span>hubklemmadj, <span class="dt">wdir=</span>wdir)
<span class="kw"><a href="../reference/readCoNet.html">readCoNet</a></span>(<span class="dt">name=</span><span class="st">"fisher"</span>, <span class="dt">mode=</span><span class="st">"hubs"</span>, <span class="dt">x=</span><span class="dv">1</span>, <span class="dt">n=</span><span class="dv">100</span>, <span class="dt">alldata=</span>hubdata, <span class="dt">setname=</span>set4, <span class="dt">tool=</span><span class="st">"CoNet Fisher"</span>, <span class="dt">klemmadj=</span>hubklemmadj, <span class="dt">wdir=</span>wdir)
<span class="kw"><a href="../reference/readSpar.html">readSpar</a></span>(<span class="dt">n=</span><span class="dv">100</span>, <span class="dt">x=</span><span class="dv">1</span>, <span class="dt">mode=</span><span class="st">"hubs"</span>, <span class="dt">alldata=</span>hubdata, <span class="dt">setname=</span>set4, <span class="dt">klemmadj=</span>hubklemmadj, <span class="dt">wdir=</span>wdir)</code></pre></div>
</div>
<div id="results-visualization" class="section level2">
<h2 class="hasAnchor">
<a href="#results-visualization" class="anchor"></a>Results visualization</h2>
<p>The results can be visualized using the functions in this package. We load the network files from the data folder.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(<span class="st">"ggplot2"</span>)
<span class="co">#&gt; Warning: package 'ggplot2' was built under R version 3.4.3</span>
<span class="kw">library</span>(<span class="st">"NetworkUtils"</span>)
<span class="kw">library</span>(<span class="st">"SuperExactTest"</span>)
<span class="co">#&gt; Warning: package 'SuperExactTest' was built under R version 3.4.3</span>
<span class="co">#&gt; Loading required package: grid</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Attaching package: 'SuperExactTest'</span>
<span class="co">#&gt; The following object is masked from 'package:igraph':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     union</span>
<span class="co">#&gt; The following objects are masked from 'package:base':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     intersect, union</span>
<span class="kw">library</span>(<span class="st">"viridis"</span>)
<span class="co">#&gt; Warning: package 'viridis' was built under R version 3.4.3</span>
<span class="co">#&gt; Loading required package: viridisLite</span>
col1 =<span class="st"> </span><span class="kw">viridis</span>(<span class="dv">8</span>)
col1[<span class="dv">4</span>] =<span class="st"> "#A437EE"</span>
col1[<span class="dv">1</span>] =<span class="st"> "#000000"</span>
col2 =<span class="st"> </span><span class="kw">c</span>(col1[<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>], col1[<span class="dv">5</span><span class="op">:</span><span class="dv">8</span>])
col1 =<span class="st"> </span><span class="kw">c</span>(col1[<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>], col1[<span class="dv">5</span><span class="op">:</span><span class="dv">8</span>], col1[<span class="dv">4</span>])
col3 =<span class="st"> </span><span class="kw">c</span>(<span class="st">"#A437EE"</span>, col2)
n =<span class="st"> </span><span class="dv">100</span>
x =<span class="st"> </span><span class="dv">1</span>

spiecmb =<span class="st"> </span><span class="kw">readRDS</span>(<span class="st">"../../data/Hub species networks/SpiecEasi MB_hubs_networks.rds"</span>)
spiecgl =<span class="st"> </span><span class="kw">readRDS</span>(<span class="st">"../../data/Hub species networks/SpiecEasi GL_hubs_networks.rds"</span>)
spear =<span class="st"> </span><span class="kw">readRDS</span>(<span class="st">"../../data/Hub species networks/Spearman_hubs_networks.rds"</span>)
spar =<span class="st"> </span><span class="kw">readRDS</span>(<span class="st">"../../data/Hub species networks/SparCC_hubs_networks.rds"</span>)
coda =<span class="st"> </span><span class="kw">readRDS</span>(<span class="st">"../../data/Hub species networks/gCoda_hubs_networks.rds"</span>)
fisher =<span class="st"> </span><span class="kw">readRDS</span>(<span class="st">"../../data/Hub species networks/CoNet_fisher_hubs_networks.rds"</span>)
brown =<span class="st"> </span><span class="kw">readRDS</span>(<span class="st">"../../data/Hub species networks/CoNet_brown_hubs_networks.rds"</span>)
hubklemmadj =<span class="st"> </span><span class="kw">readRDS</span>(<span class="st">"../../data/hubklemm_adj.rds"</span>)

tools =<span class="st"> </span><span class="kw">c</span>(<span class="st">"True positives"</span>, <span class="st">"CoNet Brown"</span>, <span class="st">"CoNet Fisher"</span>, <span class="st">"gCoda"</span>,<span class="st">"SparCC"</span>, <span class="st">"Spearman"</span>, <span class="st">"SPIEC-EASI GL"</span>,  <span class="st">"SPIEC-EASI MB"</span>)
results =<span class="st"> </span><span class="kw">list</span>(hubklemmadj, brown, fisher, coda, spar, spear, spiecgl, spiecmb)

num =<span class="st"> </span><span class="dv">5</span>
<span class="co"># Returns a list of the top # num hub species</span>
hubs =<span class="st"> </span><span class="kw"><a href="../reference/analyseHubs.html">analyseHubs</a></span>(results, tools, <span class="dt">n =</span> <span class="dv">100</span>, <span class="dt">mode=</span><span class="st">"hub"</span>, num)
central =<span class="st"> </span><span class="kw"><a href="../reference/analyseHubs.html">analyseHubs</a></span>(results, tools, <span class="dt">n =</span> <span class="dv">100</span>, <span class="dt">mode=</span><span class="st">"central"</span>, num)
<span class="co"># Calculates degree and centrality </span>
degrees =<span class="st"> </span><span class="kw"><a href="../reference/analyseDeg.html">analyseDeg</a></span>(results, tools, <span class="dt">n =</span> <span class="dv">100</span>, <span class="dt">mode=</span><span class="st">"hub"</span>)
centralscores =<span class="st"> </span><span class="kw"><a href="../reference/analyseDeg.html">analyseDeg</a></span>(results, tools, <span class="dt">n =</span> <span class="dv">100</span>, <span class="dt">mode=</span><span class="st">"central"</span>)
degrees<span class="op">$</span>X1 =<span class="st"> </span><span class="kw">factor</span>(degrees<span class="op">$</span>X1, <span class="dt">levels=</span><span class="kw">levels</span>(degrees<span class="op">$</span>X1)[<span class="kw">c</span>(<span class="dv">8</span>,<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">7</span>)])
centralscores<span class="op">$</span>X1 =<span class="st"> </span><span class="kw">factor</span>(centralscores<span class="op">$</span>X1, <span class="dt">levels=</span><span class="kw">levels</span>(centralscores<span class="op">$</span>X1)[<span class="kw">c</span>(<span class="dv">8</span>,<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">7</span>)])

<span class="co"># Generates a Superset compatible dataframe and produces figures</span>
dataset =<span class="st"> </span><span class="kw"><a href="../reference/plotSuperSet.html">plotSuperSet</a></span>(hubs, tools, num, <span class="dt">plot=</span><span class="ot">TRUE</span>)
centralset =<span class="st"> </span><span class="kw"><a href="../reference/plotSuperSet.html">plotSuperSet</a></span>(central, tools, num, <span class="dt">plot=</span><span class="ot">TRUE</span>)

dataset[[<span class="dv">1</span>]]</code></pre></div>
<p><img src="hub-species_files/figure-html/unnamed-chunk-3-1.png" width="480"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dataset[[<span class="dv">2</span>]]</code></pre></div>
<p><img src="hub-species_files/figure-html/unnamed-chunk-3-2.png" width="480"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># The UpSet library provides convenient functions for visualization of intersecting sets</span>
<span class="kw">library</span>(UpSetR)
<span class="co">#&gt; </span>
<span class="co">#&gt; Attaching package: 'UpSetR'</span>
<span class="co">#&gt; The following object is masked from 'package:lattice':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     histogram</span>

hubset =<span class="st"> </span><span class="kw"><a href="../reference/plotUpset.html">plotUpset</a></span>(hubs, tools)
centralset =<span class="st"> </span><span class="kw"><a href="../reference/plotUpset.html">plotUpset</a></span>(central, tools)

string =<span class="st"> </span><span class="kw">c</span>(col1[<span class="dv">8</span>], <span class="kw">rep</span>(<span class="st">"Black"</span>, <span class="dv">4</span>), col1[<span class="dv">1</span>], <span class="kw">rep</span>(<span class="st">"Black"</span>, <span class="dv">4</span>), col1[<span class="dv">2</span>], <span class="kw">rep</span>(<span class="st">"Black"</span>, <span class="dv">4</span>),
           col1[<span class="dv">3</span>], <span class="kw">rep</span>(<span class="st">"Black"</span>, <span class="dv">4</span>), col1[<span class="dv">4</span>], <span class="kw">rep</span>(<span class="st">"Black"</span>, <span class="dv">4</span>),
           col1[<span class="dv">5</span>], <span class="kw">rep</span>(<span class="st">"Black"</span>, <span class="dv">4</span>), col1[<span class="dv">6</span>], <span class="kw">rep</span>(<span class="st">"Black"</span>, <span class="dv">4</span>), col1[<span class="dv">7</span>], <span class="kw">rep</span>(<span class="st">"Black"</span>, <span class="dv">4</span>))
<span class="kw">upset</span>(hubset, <span class="dt">text.scale =</span> <span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="fl">1.8</span>, <span class="dv">2</span>), <span class="dt">sets =</span> tools, <span class="dt">keep.order=</span><span class="ot">TRUE</span>, <span class="dt">order.by=</span><span class="st">"freq"</span>, <span class="dt">cutoff =</span> <span class="dv">5</span>, <span class="dt">group.by=</span><span class="st">"sets"</span>, <span class="dt">sets.x.label =</span> <span class="st">"Tools"</span>, <span class="dt">mainbar.y.label =</span> <span class="st">"Hub species sets"</span>, <span class="dt">main.bar.color=</span>string)</code></pre></div>
<p><img src="hub-species_files/figure-html/unnamed-chunk-4-1.png" width="864"></p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#dataset-generation">Dataset generation</a></li>
      <li><a href="#network-inference">Network inference</a></li>
      <li><a href="#results-visualization">Results visualization</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Lisa Rottjers.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  </body>
</html>
